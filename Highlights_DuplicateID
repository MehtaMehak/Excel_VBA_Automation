Option Explicit

' Highlight duplicate IDs in column A (from row 2 down)
' - Stores the first occurrence in a dictionary
' - Highlights both the first occurrence and any later duplicates in yellow
' - Removes previous highlights before running
' - Safe for empty sheets/columns

Sub HighlightDuplicateID()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim rng As Range
    Dim cell As Range
    Dim dict As Object              ' Scripting.Dictionary
    Dim key As String
    Dim existingCell As Range
    
    On Error GoTo ErrHandler
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    Set ws = ThisWorkbook.Worksheets("EmployeeData")
    
    ' find last used row in column A
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    If lastRow < 2 Then
        MsgBox "No data found in column A starting from row 2.", vbInformation
        GoTo Cleanup
    End If
    
    Set rng = ws.Range("A2:A" & lastRow)
    
    ' clear previous interior color (only for that range)
    rng.Interior.Pattern = xlNone
    
    ' create dictionary
    Set dict = CreateObject("Scripting.Dictionary")
    dict.CompareMode = vbTextCompare    ' case-insensitive keys
    
    ' loop through IDs
    For Each cell In rng
        If Len(Trim(CStr(cell.Value))) > 0 Then
            key = CStr(Trim(cell.Value))
            If dict.Exists(key) Then
                ' highlight current cell
                cell.Interior.Color = vbYellow
                ' highlight the first occurrence stored in the dictionary
                Set existingCell = dict(key)
                If Not existingCell Is Nothing Then
                    existingCell.Interior.Color = vbYellow
                End If
            Else
                ' store the Range object for the first occurrence
                dict.Add key, cell
            End If
        End If
    Next cell

Cleanup:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    Exit Sub

ErrHandler:
    MsgBox "Error " & Err.Number & ": " & Err.Description, vbExclamation, "HighlightDuplicateID"
    Resume Cleanup
End Sub

